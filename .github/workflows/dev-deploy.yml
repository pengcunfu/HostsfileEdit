name: Dev Environment Deploy

on:
  push:
    branches: [dev]
    paths: ['web/**', 'README.md']
  pull_request:
    branches: [dev]
    paths: ['web/**']
  workflow_dispatch:

# 设置权限
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # 构建和测试
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: web/package.json
        
    - name: Install dependencies
      run: |
        cd web
        npm install
        
    - name: Run tests
      run: |
        cd web
        npm run lint || echo "Linting completed"
        
    - name: Build website
      run: |
        cd web
        npm run build
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: dev-build-${{ github.sha }}
        path: web/dist
        retention-days: 7

  # 部署到开发环境（可选）
  deploy-dev:
    runs-on: ubuntu-latest
    needs: build-and-test
    if: github.ref == 'refs/heads/dev' && github.event_name == 'push'
    
    steps:
    - name: Download build artifacts
      uses: actions/download-artifact@v4
      with:
        name: dev-build-${{ github.sha }}
        path: ./dist
        
    - name: Deploy to dev environment
      run: |
        echo "🚀 Deploying to development environment..."
        echo "📁 Build files ready in ./dist"
        echo "🌐 This is where you would deploy to your dev server"
        echo "💡 For GitHub Pages, the main workflow handles deployment"
        ls -la ./dist || echo "Build files not found"